{% extends 'base.html' %}

{% block title %}Support Tickets â€” Tech-IT Solutions{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <div>
      <h2 class="fw-bold mb-0">Support Tickets</h2>
      <p class="text-muted mb-0 small">Track and manage your support requests</p>
    </div>
    <a href="{% url 'tickets:create' %}" class="btn btn-primary fw-semibold">
      <i class="bi bi-plus-circle me-1"></i>New Ticket
    </a>
  </div>

  {% for message in messages %}
    <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show rounded-3 mb-3">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endfor %}

  {% if tickets %}
    <div class="card border-0 shadow-sm rounded-4">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Ref</th>
              <th>Subject</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Replies</th>
              <th>Last Updated</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for ticket in tickets %}
              <tr>
                <td class="ps-4">
                  <span class="badge bg-light text-dark fw-mono">{{ ticket.reference_short }}</span>
                </td>
                <td>
                  <a href="{% url 'tickets:detail' ticket.pk %}" class="fw-semibold text-decoration-none text-dark">
                    {{ ticket.subject }}
                  </a>
                </td>
                <td>
                  {% if ticket.priority == "urgent" %}
                    <span class="badge bg-danger">Urgent</span>
                  {% elif ticket.priority == "high" %}
                    <span class="badge bg-warning text-dark">High</span>
                  {% elif ticket.priority == "normal" %}
                    <span class="badge bg-secondary">Normal</span>
                  {% else %}
                    <span class="badge bg-light text-dark">Low</span>
                  {% endif %}
                </td>
                <td>
                  {% if ticket.status == "open" %}
                    <span class="badge bg-success">Open</span>
                  {% elif ticket.status == "in_progress" %}
                    <span class="badge bg-primary">In Progress</span>
                  {% elif ticket.status == "waiting" %}
                    <span class="badge bg-warning text-dark">Waiting</span>
                  {% elif ticket.status == "resolved" %}
                    <span class="badge bg-info text-dark">Resolved</span>
                  {% else %}
                    <span class="badge bg-secondary">Closed</span>
                  {% endif %}
                </td>
                <td class="text-muted small">{{ ticket.message_count }}</td>
                <td class="text-muted small">{{ ticket.updated_at|date:"N j, Y" }}</td>
                <td>
                  <a href="{% url 'tickets:detail' ticket.pk %}" class="btn btn-sm btn-outline-secondary">
                    View <i class="bi bi-arrow-right ms-1"></i>
                  </a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="text-center py-5">
      <i class="bi bi-chat-square-dots fs-1 text-muted d-block mb-3"></i>
      <h5 class="fw-bold text-muted">No tickets yet</h5>
      <p class="text-muted mb-4">Got a question or issue? We're here to help.</p>
      <a href="{% url 'tickets:create' %}" class="btn btn-primary fw-semibold">
        <i class="bi bi-plus-circle me-1"></i>Open Your First Ticket
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
